import{r,a as V,f as ee,b as te,P as se,L as ne,j as t,u as re,m as F}from"./index-CesDyvRg.js";import{u as G}from"./testStore-B6qyTNA8.js";import{c as T,a as ae,b as oe,B as C}from"./createLucideIcon-DyfPgvOr.js";import{D as ie}from"./download-CPVpN1lM.js";function B(){const e=r.useRef(!1);return V(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function le(){const e=B(),[s,n]=r.useState(0),a=r.useCallback(()=>{e.current&&n(s+1)},[s]);return[r.useCallback(()=>ee.postRender(a),[a]),s]}class ce extends r.Component{getSnapshotBeforeUpdate(s){const n=this.props.childRef.current;if(n&&s.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=n.offsetHeight||0,a.width=n.offsetWidth||0,a.top=n.offsetTop,a.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function de({children:e,isPresent:s}){const n=r.useId(),a=r.useRef(null),l=r.useRef({width:0,height:0,top:0,left:0});return r.useInsertionEffect(()=>{const{width:d,height:c,top:o,left:u}=l.current;if(s||!a.current||!d||!c)return;a.current.dataset.motionPopId=n;const f=document.createElement("style");return document.head.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${c}px !important;
            top: ${o}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(f)}},[s]),r.createElement(ce,{isPresent:s,childRef:a,sizeRef:l},r.cloneElement(e,{ref:a}))}const O=({children:e,initial:s,isPresent:n,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:c})=>{const o=te(ue),u=r.useId(),f=r.useMemo(()=>({id:u,initial:s,isPresent:n,custom:l,onExitComplete:m=>{o.set(m,!0);for(const x of o.values())if(!x)return;a&&a()},register:m=>(o.set(m,!1),()=>o.delete(m))}),d?void 0:[n]);return r.useMemo(()=>{o.forEach((m,x)=>o.set(x,!1))},[n]),r.useEffect(()=>{!n&&!o.size&&a&&a()},[n]),c==="popLayout"&&(e=r.createElement(de,{isPresent:n},e)),r.createElement(se.Provider,{value:f},e)};function ue(){return new Map}function me(e){return r.useEffect(()=>()=>e(),[])}const _=e=>e.key||"";function xe(e,s){e.forEach(n=>{const a=_(n);s.set(a,n)})}function fe(e){const s=[];return r.Children.forEach(e,n=>{r.isValidElement(n)&&s.push(n)}),s}const pe=({children:e,custom:s,initial:n=!0,onExitComplete:a,exitBeforeEnter:l,presenceAffectsLayout:d=!0,mode:c="sync"})=>{const o=r.useContext(ne).forceRender||le()[0],u=B(),f=fe(e);let m=f;const x=r.useRef(new Map).current,h=r.useRef(m),v=r.useRef(new Map).current,y=r.useRef(!0);if(V(()=>{y.current=!1,xe(f,v),h.current=m}),me(()=>{y.current=!0,v.clear(),x.clear()}),y.current)return r.createElement(r.Fragment,null,m.map(i=>r.createElement(O,{key:_(i),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:d,mode:c},i)));m=[...m];const b=h.current.map(_),w=f.map(_),P=b.length;for(let i=0;i<P;i++){const p=b[i];w.indexOf(p)===-1&&!x.has(p)&&x.set(p,void 0)}return c==="wait"&&x.size&&(m=[]),x.forEach((i,p)=>{if(w.indexOf(p)!==-1)return;const j=v.get(p);if(!j)return;const I=b.indexOf(p);let R=i;if(!R){const L=()=>{x.delete(p);const S=Array.from(v.keys()).filter(k=>!w.includes(k));if(S.forEach(k=>v.delete(k)),h.current=f.filter(k=>{const g=_(k);return g===p||S.includes(g)}),!x.size){if(u.current===!1)return;o(),a&&a()}};R=r.createElement(O,{key:_(j),isPresent:!1,onExitComplete:L,custom:s,presenceAffectsLayout:d,mode:c},j),x.set(p,R)}m.splice(I,0,R)}),m=m.map(i=>{const p=i.key;return x.has(p)?i:r.createElement(O,{key:_(i),isPresent:!0,presenceAffectsLayout:d,mode:c},i)}),r.createElement(r.Fragment,null,x.size?m:m.map(i=>r.cloneElement(i)))};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=T("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=T("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=T("PhoneOutgoing",[["polyline",{points:"22 8 22 2 16 2",key:"1g204g"}],["line",{x1:"16",x2:"22",y1:"8",y2:"2",key:"1ggias"}],["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);function ye(e,s=[]){let n=[];function a(d,c){const o=r.createContext(c),u=n.length;n=[...n,c];const f=x=>{var P;const{scope:h,children:v,...y}=x,b=((P=h==null?void 0:h[e])==null?void 0:P[u])||o,w=r.useMemo(()=>y,Object.values(y));return t.jsx(b.Provider,{value:w,children:v})};f.displayName=d+"Provider";function m(x,h){var b;const v=((b=h==null?void 0:h[e])==null?void 0:b[u])||o,y=r.useContext(v);if(y)return y;if(c!==void 0)return c;throw new Error(`\`${x}\` must be used within \`${d}\``)}return[f,m]}const l=()=>{const d=n.map(c=>r.createContext(c));return function(o){const u=(o==null?void 0:o[e])||d;return r.useMemo(()=>({[`__scope${e}`]:{...o,[e]:u}}),[o,u])}};return l.scopeName=e,[a,be(l,...s)]}function be(...e){const s=e[0];if(e.length===1)return s;const n=()=>{const a=e.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(d){const c=a.reduce((o,{useScope:u,scopeName:f})=>{const x=u(d)[`__scope${f}`];return{...o,...x}},{});return r.useMemo(()=>({[`__scope${s.scopeName}`]:c}),[c])}};return n.scopeName=s.scopeName,n}var we=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],W=we.reduce((e,s)=>{const n=ae(`Primitive.${s}`),a=r.forwardRef((l,d)=>{const{asChild:c,...o}=l,u=c?n:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),t.jsx(u,{...o,ref:d})});return a.displayName=`Primitive.${s}`,{...e,[s]:a}},{}),D="Progress",z=100,[Ne,Oe]=ye(D),[je,Ce]=Ne(D),H=r.forwardRef((e,s)=>{const{__scopeProgress:n,value:a=null,max:l,getValueLabel:d=Pe,...c}=e;(l||l===0)&&!K(l)&&console.error(ke(`${l}`,"Progress"));const o=K(l)?l:z;a!==null&&!Q(a,o)&&console.error(Ee(`${a}`,"Progress"));const u=Q(a,o)?a:null,f=M(u)?d(u,o):void 0;return t.jsx(je,{scope:n,value:u,max:o,children:t.jsx(W.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":M(u)?u:void 0,"aria-valuetext":f,role:"progressbar","data-state":J(u,o),"data-value":u??void 0,"data-max":o,...c,ref:s})})});H.displayName=D;var X="ProgressIndicator",Z=r.forwardRef((e,s)=>{const{__scopeProgress:n,...a}=e,l=Ce(X,n);return t.jsx(W.div,{"data-state":J(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...a,ref:s})});Z.displayName=X;function Pe(e,s){return`${Math.round(e/s*100)}%`}function J(e,s){return e==null?"indeterminate":e===s?"complete":"loading"}function M(e){return typeof e=="number"}function K(e){return M(e)&&!isNaN(e)&&e>0}function Q(e,s){return M(e)&&!isNaN(e)&&e<=s&&e>=0}function ke(e,s){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${z}\`.`}function Ee(e,s){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${z} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Y=H,_e=Z;const q=r.forwardRef(({className:e,value:s,...n},a)=>t.jsx(Y,{ref:a,className:oe("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...n,children:t.jsx(_e,{className:"h-full w-full flex-1 bg-orange transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));q.displayName=Y.displayName;const Re=({question:e})=>e.type!=="information_guide"||!e.step_by_step_guide?t.jsx("p",{className:"text-red-500",children:"Fehler: Ungültige Frage für Informationsleitfaden."}):t.jsxs("div",{className:"w-full max-w-lg mx-auto shadow-lg bg-white rounded-lg p-6",children:[t.jsx("div",{className:"mb-4",children:t.jsx("h3",{className:"text-xl font-semibold text-navy",children:e.prompt})}),t.jsx("div",{children:t.jsx("div",{className:"h-[300px] w-full p-4 border rounded-md bg-slate-50 overflow-y-auto",children:t.jsx("ul",{className:"list-decimal list-inside space-y-3 text-gray-700",children:e.step_by_step_guide.map((s,n)=>t.jsx("li",{className:"text-base leading-relaxed",children:s},n))})})})]}),Se=({question:e})=>e.type!=="information_contacts"||!e.emergency_contacts?t.jsx("p",{className:"text-red-500",children:"Fehler: Ungültige Frage für Notfallkontakte."}):t.jsxs("div",{className:"w-full max-w-lg mx-auto shadow-lg bg-white rounded-lg p-6",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold text-navy",children:e.prompt}),t.jsx("p",{className:"text-gray-600",children:"Hier findest du wichtige Anlaufstellen:"})]}),t.jsx("div",{className:"space-y-4",children:e.emergency_contacts.map((s,n)=>t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border",children:[t.jsx("h3",{className:"font-semibold text-lg text-orange mb-1",children:s.name}),t.jsx("p",{className:"text-gray-700 text-sm mb-2",children:s.details}),s.url&&t.jsxs(C,{variant:"link",className:"p-0 h-auto text-sm text-teal hover:text-teal-dark",onClick:()=>window.open(s.url,"_blank"),children:["Website besuchen ",t.jsx(ve,{className:"ml-2 h-4 w-4"})]})]},n))})]}),$e=({question:e})=>{var n,a,l;if(e.type!=="download_resource"||!e.downloadable_resource)return t.jsx("p",{className:"text-red-500",children:"Fehler: Ungültige Frage für Download-Ressource."});const s=()=>{var c,o;const d=document.createElement("a");d.href=((c=e.downloadable_resource)==null?void 0:c.url)||"#",d.download=((o=e.downloadable_resource)==null?void 0:o.fileName)||"download",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return t.jsxs("div",{className:"w-full max-w-lg mx-auto shadow-lg bg-white rounded-lg p-6",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold text-navy",children:e.prompt}),((n=e.downloadable_resource)==null?void 0:n.text)&&t.jsx("p",{className:"text-gray-600 mt-2",children:e.downloadable_resource.text})]}),t.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.jsxs(C,{onClick:s,variant:"cta",size:"lg",className:"bg-teal hover:bg-teal-dark text-white",children:[t.jsx(ie,{className:"mr-2 h-5 w-5"}),((a=e.downloadable_resource)==null?void 0:a.fileName)||"Datei herunterladen"]}),((l=e.downloadable_resource)==null?void 0:l.url)&&t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Quelle: ",e.downloadable_resource.url]})]})]})},Te=({embedded:e=!1})=>{const s=re(),{currentQuestionIndex:n,answers:a,questions:l,isTestStarted:d,isTestCompleted:c,startTest:o,nextQuestion:u,previousQuestion:f,answerQuestion:m,completeTest:x,loadQuestions:h,isLoadingQuestions:v,errorLoadingQuestions:y,currentPhase:b}=G(),[w,P]=r.useState("");r.useEffect(()=>{G.getState().allQuestions.length===0&&h()},[h]),r.useEffect(()=>{c&&!e&&s("/result")},[c,s,e]);const i=l[n],p=(n+1)/l.length*100,j=n===l.length-1,I=w!=="",R=n>0;r.useEffect(()=>{const g=a.find(E=>E.questionId===(i==null?void 0:i.id));P((g==null?void 0:g.selectedOptionId)||"")},[i==null?void 0:i.id,a]);const L=g=>{if(!i||!i.options)return;P(g);const E=i.options.find($=>$.id===g);E&&m({questionId:i.id,selectedOptionId:g,score:E.score||0})},S=()=>{j?x():u()},k=()=>{f()};return v?t.jsx("div",{className:"text-center p-10",children:"Fragen werden geladen..."}):y?t.jsxs("div",{className:"text-center p-10 text-red-600",children:["Fehler beim Laden der Fragen: ",y]}):d?!i&&d?t.jsx("div",{className:"text-center p-10",children:"Keine Fragen für diesen Testabschnitt verfügbar oder Test nicht korrekt gestartet."}):!i&&!d?t.jsx("div",{className:"text-center p-10",children:"Test initialisieren..."}):i?t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Frage ",n+1," von ",l.length]}),t.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[Math.round(p),"% abgeschlossen"]})]}),t.jsx(q,{value:p,className:"h-2"})]}),b&&t.jsx("div",{className:"flex justify-center mb-6",children:t.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-semibold ${b==="spot"?"bg-orange/20 text-orange":"bg-navy/20 text-navy"}`,children:b==="spot"?"ERKENNEN":"STOPPEN"})}),t.jsx(pe,{mode:"wait",children:t.jsx(F.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},className:"w-full",children:(()=>{var g,E,$,U,A;switch(i.type){case"multiple_choice_score":case"multiple_choice_action":return t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold text-navy mb-6 sm:mb-8 leading-tight",children:i.prompt}),t.jsx("div",{className:"space-y-3 sm:space-y-4",children:(g=i.options)==null?void 0:g.map(N=>t.jsx(F.div,{whileHover:{scale:1.03},whileTap:{scale:.98},children:t.jsx(C,{variant:w===N.id?"cta":"outline",size:"lg",onClick:()=>L(N.id),className:`w-full text-left justify-start h-auto py-3 sm:py-4 px-4 sm:px-6 text-base sm:text-lg whitespace-normal break-words ${w===N.id?"ring-2 ring-orange ring-offset-2":""}`,children:N.text})},N.id))}),w&&(($=(E=i.options)==null?void 0:E.find(N=>N.id===w))==null?void 0:$.feedback)&&t.jsx(F.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 sm:p-4 bg-sky-100 border border-sky-300 rounded-md text-sky-800 text-sm sm:text-base",children:(A=(U=i.options)==null?void 0:U.find(N=>N.id===w))==null?void 0:A.feedback})]});case"information_guide":return t.jsx(Re,{question:i});case"information_contacts":return t.jsx(Se,{question:i});case"download_resource":return t.jsx($e,{question:i});default:return t.jsxs("p",{className:"text-red-500",children:["Unbekannter Fragetyp: ",i.type]})}})()},i.id)}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs(C,{onClick:k,disabled:!R,variant:"outline",className:"flex items-center",children:[t.jsx(he,{className:"w-4 h-4 mr-2"}),"Zurück"]}),t.jsxs(C,{onClick:S,disabled:!I,variant:j?"cta":"orange",className:"flex items-center",children:[j?"Test beenden":"Weiter",!j&&t.jsx(ge,{className:"w-4 h-4 ml-2"})]})]})]}):t.jsx("div",{className:"text-center p-10",children:"Ein unerwarteter Fehler ist aufgetreten. Aktuelle Frage nicht gefunden."}):v?t.jsx("div",{className:"text-center p-10",children:"Fragen werden geladen..."}):t.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-2xl mx-auto text-center",children:[t.jsx("h2",{className:"text-3xl font-bold text-navy mb-4",children:"Wähle einen Schwierigkeitsgrad"}),t.jsx("p",{className:"text-lg text-gray-600 mb-8",children:"Wähle den Level, mit dem du beginnen möchtest."}),t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx(C,{onClick:()=>o("spot",1),variant:"outline",size:"lg",className:"text-lg px-8 py-4 w-full max-w-xs",children:"Level 1: Grundlagen-Sensibilisierung"}),t.jsx(C,{onClick:()=>o("spot",2),variant:"outline",size:"lg",className:"text-lg px-8 py-4 w-full max-w-xs",children:"Level 2: Manipulation erkennen"}),t.jsx(C,{onClick:()=>o("spot",3),variant:"outline",size:"lg",className:"text-lg px-8 py-4 w-full max-w-xs",children:"Level 3: Eskalationsmuster erkennen"})]})]})};export{Te as T};
